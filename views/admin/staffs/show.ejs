<!-- üîπ ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏Å -->
<section class="hero text-center py-5 rounded-4 shadow-sm mb-5" 
  style="background: linear-gradient(135deg, #1e3c72, #2a5298); color: white;">
  <div class="mb-3">
    <i class="bi bi-person-badge" style="font-size: 3rem;"></i>
  </div>
  <h1 class="fw-bold mb-2" style="font-size: 2.5rem;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</h1>
  <p class="mb-0 fs-5"><%= staff.full_name %></p>
</section>

<!-- üîπ ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö/‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ -->
<div class="d-flex flex-wrap gap-2 mb-4">
  <a href="/admin/staffs" class="btn btn-outline-secondary d-inline-flex align-items-center">
    <i class="bi bi-arrow-left me-2"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠
  </a>
  <a href="/admin/staffs/edit/<%= staff.id %>" class="btn btn-warning d-inline-flex align-items-center">
    <i class="bi bi-pencil me-2"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  </a>
  <form action="/admin/staffs/delete/<%= staff.id %>" method="POST" style="display:inline;" onsubmit="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ô‡∏µ‡πâ? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏≤‡∏ß‡∏£!');">
    <button type="submit" class="btn btn-danger d-inline-flex align-items-center">
      <i class="bi bi-trash me-2"></i> ‡∏•‡∏ö‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£
    </button>
  </form>
</div>

<!-- üîπ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£ -->
<div class="card shadow-sm rounded-3 border-0 mb-4">
  <div class="card-header bg-light py-3 px-4 border-0 rounded-top-3">
    <h5 class="mb-0"><i class="bi bi-file-person me-2"></i>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h5>
  </div>
  <div class="card-body p-4">
    <div class="row g-4">
      <div class="col-md-6">
        <div class="d-flex mb-3">
          <div class="me-3" style="color: #2a5298; font-size: 1.3rem;"><i class="bi bi-hash"></i></div>
          <div class="flex-grow-1">
            <div class="text-muted small fw-600">‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</div>
            <div class="fw-semibold fs-5">#<%= staff.id %></div>
          </div>
        </div>

        <div class="d-flex mb-3">
          <div class="me-3" style="color: #2a5298; font-size: 1.3rem;"><i class="bi bi-person"></i></div>
          <div class="flex-grow-1">
            <div class="text-muted small fw-600">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</div>
            <div class="fw-semibold fs-5"><%= staff.full_name %></div>
          </div>
        </div>

        <div class="d-flex mb-3">
          <div class="me-3" style="color: #2a5298; font-size: 1.3rem;"><i class="bi bi-envelope"></i></div>
          <div class="flex-grow-1">
            <div class="text-muted small fw-600">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>
            <div class="fw-normal"><a href="mailto:<%= staff.email %>" class="text-decoration-none"><%= staff.email %></a></div>
          </div>
        </div>

        <div class="d-flex mb-3">
          <div class="me-3" style="color: #2a5298; font-size: 1.3rem;"><i class="bi bi-telephone"></i></div>
          <div class="flex-grow-1">
            <div class="text-muted small fw-600">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</div>
            <div class="fw-normal"><%= staff.phone ? '<a href="tel:' + staff.phone + '" class="text-decoration-none">' + staff.phone + '</a>' : '<span class="text-muted">-</span>' %></div>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="d-flex mb-3">
          <div class="me-3" style="color: #2a5298; font-size: 1.3rem;"><i class="bi bi-briefcase"></i></div>
          <div class="flex-grow-1">
            <div class="text-muted small fw-600">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div>
            <div class="fw-normal"><%= staff.position || '<span class="text-muted">-</span>' %></div>
          </div>
        </div>

        <div class="d-flex mb-3">
          <div class="me-3" style="color: #2a5298; font-size: 1.3rem;"><i class="bi bi-building"></i></div>
          <div class="flex-grow-1">
            <div class="text-muted small fw-600">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
            <div class="fw-normal"><%= staff.school_name || '<span class="text-muted">-</span>' %></div>
          </div>
        </div>

        <div class="d-flex mb-3">
          <div class="me-3" style="color: #2a5298; font-size: 1.3rem;"><i class="bi bi-calendar-plus"></i></div>
          <div class="flex-grow-1">
            <div class="text-muted small fw-600">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠</div>
            <div class="fw-normal"><%= new Date(staff.created_at).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></div>
          </div>
        </div>

        <% if (staff.updated_at && staff.updated_at !== staff.created_at) { %>
        <div class="d-flex mb-3">
          <div class="me-3" style="color: #2a5298; font-size: 1.3rem;"><i class="bi bi-clock-history"></i></div>
          <div class="flex-grow-1">
            <div class="text-muted small fw-600">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
            <div class="fw-normal"><%= new Date(staff.updated_at).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' }) %></div>
          </div>
        </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<!-- üîπ ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£ -->
<div class="card shadow-sm rounded-3 border-0">
  <div class="card-header bg-light py-3 px-4 border-0 rounded-top-3">
    <div class="d-flex justify-content-between align-items-center">
      <h5 class="mb-0"><i class="bi bi-award me-2" style="color: #2a5298;"></i>‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</h5>
      <span class="badge bg-info rounded-pill" id="cert-count">0</span>
    </div>
  </div>
  <div class="card-body p-4">
    <div id="certificates-container">
      <div class="text-center py-5">
        <i class="bi bi-inbox" style="font-size: 3rem; color: #ccc;"></i>
        <p class="text-muted mt-3 mb-0">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£...</p>
      </div>
    </div>
  </div>
</div>

<style>
  .cert-card {
    transition: all 0.3s ease;
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    overflow: hidden;
  }

  .cert-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    border-color: #2a5298;
  }

  .cert-thumbnail {
    width: 100%;
    height: 150px;
    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 3rem;
    color: #2a5298;
  }

  .cert-info {
    padding: 1rem;
  }

  .cert-number {
    color: #2a5298;
    font-weight: 700;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .cert-title {
    font-weight: 600;
    color: #333;
    margin: 0.5rem 0;
    line-height: 1.4;
  }

  .cert-issuer {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
  }

  .cert-date {
    color: #999;
    font-size: 0.85rem;
  }

  .cert-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.75rem;
  }

  .cert-actions a {
    flex: 1;
    padding: 0.5rem;
    text-align: center;
    border-radius: 6px;
    font-size: 0.85rem;
    text-decoration: none;
    transition: all 0.2s;
  }

  .cert-view {
    background: #e3f2fd;
    color: #2a5298;
  }

  .cert-view:hover {
    background: #2a5298;
    color: white;
  }

  .cert-empty {
    text-align: center;
    padding: 3rem 1rem;
    color: #999;
  }

  .cert-empty i {
    font-size: 3rem;
    color: #ddd;
    margin-bottom: 1rem;
    display: block;
  }
</style>

<script>
  // ‡∏î‡∏∂‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ô‡∏µ‡πâ
  async function loadCertificates() {
    try {
      const staffId = <%= staff.id %>;
      console.log('üîç ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏∂‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£:', staffId);
      
      const response = await fetch(`/api/staff/${staffId}/certificates`);
      console.log('üì° ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á:', response.status, response.statusText);
      
      if (!response.ok) {
        const errorData = await response.json().catch(() => ({}));
        throw new Error(errorData.error || `HTTP ${response.status}: ${response.statusText}`);
      }

      const certificates = await response.json();
      console.log('‚úÖ ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£:', certificates);
      
      const container = document.getElementById('certificates-container');
      const countBadge = document.getElementById('cert-count');

      countBadge.textContent = certificates.length;

      if (certificates.length === 0) {
        container.innerHTML = `
          <div class="cert-empty">
            <i class="bi bi-inbox"></i>
            <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</p>
          </div>
        `;
        return;
      }

      let html = '<div class="row g-3">';
      
      certificates.forEach(cert => {
        const issueDate = new Date(cert.issue_date).toLocaleDateString('th-TH', {
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });

        html += `
          <div class="col-md-6 col-lg-4">
            <div class="cert-card">
              <div class="cert-thumbnail">
                <i class="bi bi-file-pdf" style="font-size: 3rem;"></i>
              </div>
              <div class="cert-info">
                <div class="cert-number">${cert.certificate_number || 'N/A'}</div>
                <div class="cert-title">${cert.title}</div>
                <div class="cert-issuer"><i class="bi bi-building me-1"></i>${cert.issuing_organization}</div>
                <div class="cert-date"><i class="bi bi-calendar me-1"></i>${issueDate}</div>
                <div class="cert-actions">
                  <a href="/staff/certificates/${cert.id}" class="cert-view" title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                    <i class="bi bi-eye me-1"></i>‡∏î‡∏π
                  </a>
                </div>
              </div>
            </div>
          </div>
        `;
      });

      html += '</div>';
      container.innerHTML = html;

    } catch (error) {
      console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£:', error);
      const container = document.getElementById('certificates-container');
      container.innerHTML = `
        <div class="alert alert-warning" role="alert">
          <i class="bi bi-exclamation-triangle me-2"></i>
          <strong>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:</strong> ${error.message}
          <br>
          <small class="text-muted">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</small>
        </div>
      `;
    }
  }

  // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
  document.addEventListener('DOMContentLoaded', loadCertificates);
</script>