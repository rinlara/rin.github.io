<% locals.activePage = 'teachers'; %>

<div class="container py-4">
  <!-- üîô ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö -->
  <div class="mb-4">
    <a href="/admin/teachers" class="btn btn-outline-secondary rounded-pill px-3">
      <i class="bi bi-arrow-left me-1"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏π
    </a>
  </div>

  <!-- üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
  <div class="card shadow-sm border-0 rounded-4 mb-4">
    <div class="card-body">
      <div class="d-flex flex-column flex-md-row gap-4 align-items-center">
        <!-- ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ onerror -->
        <img 
          src="<%= teacher.image_path && teacher.image_path.startsWith('/') ? teacher.image_path : '/images/default-teacher.png' %>" 
          alt="‡∏£‡∏π‡∏õ <%= teacher.full_name %>"
          class="rounded-circle border border-3 border-white shadow teacher-image"
          width="120" height="120"
          loading="lazy"
        >
        <div class="text-center text-md-start">
          <h2 class="mb-2 fw-bold text-primary"><%= teacher.full_name %></h2>
          <p class="text-muted mb-1">
            <%= teacher.position ? teacher.position : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á' %> 
            <% if (teacher.subject) { %> | <%= teacher.subject %><% } %>
          </p>
          <p class="text-muted mb-0">
            <i class="bi bi-geo-alt-fill me-1"></i> 
            <%= teacher.district ? teacher.district : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏≥‡πÄ‡∏†‡∏≠' %> ‚Äì
            <%= teacher.school_name ? teacher.school_name : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô' %>
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- üìû ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card h-100 shadow-sm border-0 rounded-4">
        <div class="card-body">
          <h5 class="fw-bold text-secondary mb-3"><i class="bi bi-envelope me-2"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h5>
          <ul class="list-unstyled mb-0">
            <li class="mb-2"><strong>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> <%= teacher.email || '‚Äì' %></li>
            <li><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</strong> <%= teacher.phone || '‚Äì' %></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card h-100 shadow-sm border-0 rounded-4">
        <div class="card-body">
          <h5 class="fw-bold text-secondary mb-3"><i class="bi bi-award me-2"></i> ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</h5>
          <ul class="list-unstyled mb-0">
            <li class="mb-2"><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> <span class="badge bg-primary rounded-pill px-3 py-2"><%= certificates.length %></span></li>
            <li><strong>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> 
              <%= certificates.length > 0 ? certificates[0].upload_date : '‚Äì' %>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- üèÜ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£ -->
  <div class="card shadow-sm border-0 rounded-4">
    <div class="card-header bg-white border-0 pb-0">
      <h4 class="fw-bold text-dark mb-3"><i class="bi bi-collection me-2"></i> ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (<%= certificates.length %>)</h4>
    </div>
    <div class="card-body">
      <% if (certificates.length > 0) { %>
        <div class="row g-3">
          <% certificates.forEach(cert => { %>
            <div class="col-12">
              <div class="d-flex gap-3 p-3 border rounded-3">
                <div class="flex-shrink-0 text-center">
                  <% if (cert.file_path && cert.file_path.endsWith('.pdf')) { %>
                    <i class="bi bi-file-earmark-pdf fs-1 text-danger"></i>
                  <% } else if (cert.file_path) { %>
                    <img 
                      src="<%= cert.file_path.startsWith('/') ? cert.file_path : '/' + cert.file_path %>" 
                      alt="‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£"
                      class="rounded border certificate-image"
                      width="80" height="80"
                      loading="lazy"
                    >
                  <% } else { %>
                    <i class="bi bi-file-earmark fs-1 text-muted"></i>
                  <% } %>
                </div>
                <div class="flex-grow-1">
                  <h6 class="fw-bold mb-1"><%= cert.title %></h6>
                  <p class="text-muted small mb-1">
                    ‡∏≠‡∏≠‡∏Å‡πÇ‡∏î‡∏¢: <%= cert.issuing_agency %><br>
                    ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà: <%= cert.certificate_number || '‚Äì' %>
                    <% if (cert.issue_date !== '‚Äì') { %>
                      | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å: <%= cert.issue_date %>
                    <% } %>
                  </p>
                  <p class="text-muted small mb-2"><%= cert.description || '‚Äì' %></p>
                  <% if (cert.file_path) { %>
                    <a href="<%= cert.file_path.startsWith('/') ? cert.file_path : '/' + cert.file_path %>" 
                       target="_blank" 
                       rel="noopener"
                       class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-eye me-1"></i> ‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå
                    </a>
                  <% } %>
                </div>
              </div>
            </div>
          <% }); %>
        </div>
      <% } else { %>
        <div class="text-center py-4">
          <i class="bi bi-award fs-1 text-muted mb-2"></i>
          <p class="text-muted">‡∏Ñ‡∏£‡∏π‡∏£‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</p>
        </div>
      <% } %>
    </div>
  </div>
</div>

<style>
.card-header {
  border-bottom: 1px solid #eee;
}
</style>

<!-- ‚úÖ JavaScript ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡πÑ‡∏°‡πà‡∏°‡∏µ inline handler) -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏£‡∏π
    const teacherImg = document.querySelector('.teacher-image');
    if (teacherImg) {
      teacherImg.addEventListener('error', function() {
        this.src = '/images/default-teacher.png';
      });
    }

    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£
    const certImgs = document.querySelectorAll('.certificate-image');
    certImgs.forEach(img => {
      img.addEventListener('error', function() {
        this.style.display = 'none';
      });
    });
  });
</script>