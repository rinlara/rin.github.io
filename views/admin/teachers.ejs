<% locals.activePage = 'teachers'; %>

<!-- ‡πÇ‡∏´‡∏•‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå Sarabun + Bootstrap Icons (‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô layout) -->
<!-- Removed Google Fonts to avoid CSP/font blocking -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

<style>
  body {
    font-family: 'Sarabun', sans-serif;
    background-color: #f8f9fa;
  }
 .gov-header {
  background-color: #0d2c54;
  color: white;
  border-bottom: 4px solid #d4af37;
  padding: 2rem 0; /* ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ö‡∏ô-‡∏•‡πà‡∏≤‡∏á */
  margin-bottom: 3rem;
  /* ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î width, margin, padding ‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤ */
  /* ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ block element ‡∏õ‡∏Å‡∏ï‡∏¥‡∏à‡∏∞‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß */
}
  .gov-card {
    border: 1px solid #ced4da;
    border-radius: 6px;
    box-shadow: none;
    background-color: white;
  }
  .table thead th {
    background-color: #e9ecef;
    font-weight: 600;
    color: #333;
  }
  .btn-gov-primary {
    background-color: #0d2c54;
    border-color: #0d2c54;
    color: white;
  }
  .btn-gov-primary:hover {
    background-color: #123b70;
    border-color: #123b70;
  }
  .btn-gov-info-outline {
    color: #0d2c54;
    border-color: #0d2c54;
  }
  .btn-gov-info-outline:hover {
    background-color: #0d2c54;
    color: white;
  }
  .btn-gov-warning-outline {
    color: #d39e00;
    border-color: #d39e00;
  }
  .btn-gov-warning-outline:hover {
    background-color: #d39e00;
    color: white;
  }
  .btn-gov-danger-outline {
    color: #c82333;
    border-color: #c82333;
  }
  .btn-gov-danger-outline:hover {
    background-color: #c82333;
    color: white;
  }
  .badge-primary-gov {
    background-color: #0d2c54;
    color: white;
    font-weight: 500;
    padding: 0.4em 0.8em;
    border-radius: 50rem;
  }
  .form-control, .form-select {
    border-radius: 4px;
    border: 1px solid #ced4da;
  }
  .table-hover tbody tr:hover {
    background-color: #f8f9fa;
  }
  .teacher-img {
    border: 1px solid #dee2e6;
    object-fit: cover;
  }
  /* Modal */
  .modal-content {
    border: none;
    border-radius: 6px;
  }
  .modal-header {
    border-top-left-radius: 6px;
    border-top-right-radius: 6px;
  }
</style>

<!-- üîπ ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß ‚Äî ‡∏ß‡∏≤‡∏á‡∏ô‡∏≠‡∏Å container ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á -->
<section class="gov-header">
  <div class="container">
    <div class="text-center">
      <h1 class="fw-bold mb-1 fs-4">
        <i class="bi bi-people-fill me-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ñ‡∏£‡∏π
      </h1>
      <p class="mb-0">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <%= teachers?.length || 0 %> ‡∏£‡∏≤‡∏¢</p>
    </div>
    <% if (!teachers || teachers.length === 0) { %>
      <div class="text-center mt-3">
        <a href="/admin/teachers/new" class="btn btn-gov-primary rounded-pill px-3">
          <i class="bi bi-plus-circle me-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏π‡πÉ‡∏´‡∏°‡πà
        </a>
      </div>
    <% } %>
  </div>
</section>


<div class="container">
  <!-- üîç ‡πÅ‡∏ñ‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á -->
  <div class="card gov-card mb-4">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label fw-medium">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π</label>
          <input type="text" id="searchInput" class="form-control" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•...">
        </div>
        <div class="col-md-4">
          <label class="form-label fw-medium">‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</label>
          <select id="districtFilter" class="form-select">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <% const districts = [...new Set(teachers?.map(t => t.district).filter(d => d))].sort(); %>
            <% districts.forEach(d => { %>
              <option value="<%= d %>"><%= d %></option>
            <% }); %>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label fw-medium">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
          <input type="text" id="schoolFilter" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô...">
        </div>
      </div>
    </div>
  </div>

  <!-- üë• ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π -->
  <% if (teachers && teachers.length > 0) { %>
    <div class="card gov-card">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0" id="teachersTable">
            <thead>
              <tr>
                <th width="70">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                <th>‡∏ß‡∏¥‡∏ä‡∏≤</th>
                <th>‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</th>
                <th>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                <th class="text-center">‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</th>
                <th width="160" class="text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody>
              <% teachers.forEach(teacher => { %>
                <tr 
                  data-name="<%= (teacher.full_name || '').toLowerCase() %>" 
                  data-district="<%= (teacher.district || '').toLowerCase() %>"
                  data-school="<%= (teacher.school_name || '').toLowerCase() %>">
                  <td class="text-center">
                    <img 
                      src="<%= teacher.image_path || '/images/default-teacher.png' %>" 
                      class="rounded-circle teacher-img"
                      width="36" height="36"
                      loading="lazy"
                    >
                  </td>
                  <td><%= teacher.full_name %></td>
                  <td><%= teacher.email %></td>
                  <td><%= teacher.subject %></td>
                  <td><%= teacher.district %></td>
                  <td><%= teacher.school_name %></td>
                  <td class="text-center">
                    <span class="badge badge-primary-gov">
                      <%= teacher.certificate_count || 0 %>
                    </span>
                  </td>
                  <td class="text-center">
                    <a href="/admin/teachers/<%= teacher.id %>" 
                       class="btn btn-gov-info-outline btn-sm rounded-circle me-1"
                       title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                      <i class="bi bi-eye"></i>
                    </a>
                    <a href="/admin/teachers/<%= teacher.id %>/edit" 
                       class="btn btn-gov-warning-outline btn-sm rounded-circle me-1"
                       title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                      <i class="bi bi-pencil"></i>
                    </a>
                    <button type="button" 
                            class="btn btn-gov-danger-outline btn-sm rounded-circle btn-delete"
                            title="‡∏•‡∏ö"
                            data-id="<%= teacher.id %>"
                            data-name="<%= teacher.full_name %>">
                      <i class="bi bi-trash"></i>
                    </button>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% } else { %>
    <div class="text-center py-5">
      <div class="mb-3">
        <div class="bg-light rounded-circle d-inline-flex p-3 border">
          <i class="bi bi-people fs-1 text-muted"></i>
        </div>
      </div>
      <h5 class="text-muted fw-medium">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏π</h5>
      <p class="text-muted mb-3">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏£‡∏π‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
      <a href="/admin/teachers/new" class="btn btn-gov-primary rounded-pill px-4">
        <i class="bi bi-plus-circle me-1"></i>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏£‡∏π‡πÉ‡∏´‡∏°‡πà
      </a>
    </div>
  <% } %>
</div>

<!-- ‚úÖ Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title"><i class="bi bi-exclamation-triangle me-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="‡∏õ‡∏¥‡∏î"></button>
      </div>
      <div class="modal-body">
        <p>‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö <strong id="deleteName"></strong> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?</p>
        <p class="text-muted small">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ</p>
      </div>
      <div class="modal-footer">
        <form id="deleteForm" method="POST">
          <input type="hidden" name="_method" value="DELETE" />
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button type="submit" class="btn btn-danger">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ‚úÖ JavaScript (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà) -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.body.addEventListener('click', function(e) {
      const btn = e.target.closest('.btn-delete');
      if (btn) {
        const id = btn.dataset.id;
        const name = btn.dataset.name;
        document.getElementById('deleteName').textContent = name;
        const form = document.getElementById('deleteForm');
        form.action = `/admin/teachers/${id}`;
        const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
        modal.show();
      }
    });

    document.querySelectorAll('.teacher-img').forEach(img => {
      img.addEventListener('error', function() {
        this.src = '/images/default-teacher.png';
      });
    });

    const searchInput = document.getElementById('searchInput');
    const districtFilter = document.getElementById('districtFilter');
    const schoolFilter = document.getElementById('schoolFilter');
    const rows = document.querySelectorAll('#teachersTable tbody tr');

    if (!rows.length) return;

    function filterTable() {
      const term = (searchInput?.value || '').toLowerCase();
      const district = (districtFilter?.value || '').toLowerCase();
      const school = (schoolFilter?.value || '').toLowerCase();

      rows.forEach(row => {
        const name = row.dataset.name || '';
        const dist = row.dataset.district || '';
        const sch = row.dataset.school || '';
        const match = 
          name.includes(term) &&
          (!district || dist === district) &&
          sch.includes(school);
        row.style.display = match ? '' : 'none';
      });
    }

    if (searchInput) searchInput.addEventListener('input', filterTable);
    if (districtFilter) districtFilter.addEventListener('change', filterTable);
    if (schoolFilter) schoolFilter.addEventListener('input', filterTable);
  });
</script>