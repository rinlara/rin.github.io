<%
const users = locals.users || [];
const currentRole = locals.currentRole || 'all';
const searchTerm = locals.searchTerm || '';
%>

<style>
  :root {
    --primary-navy: #003d7a;
    --primary-blue: #0052a3;
    --secondary-gold: #d4af37;
    --light-bg: #f5f7fa;
    --border-color: #e2e8f0;
    --text-dark: #1a202c;
    --text-muted: #718096;
  }

  .container-fluid {
    padding: 2.5rem;
    background: linear-gradient(135deg, var(--light-bg) 0%, #ecf0f5 100%);
  }

  .page-header {
    margin-bottom: 2.5rem;
  }

  .page-header h1 {
    color: var(--primary-navy);
    font-weight: 700;
    font-size: 2rem;
    letter-spacing: 0.3px;
    margin-bottom: 0.5rem;
  }

  .breadcrumb {
    background: transparent;
    padding: 0;
  }

  .breadcrumb-item.active {
    color: var(--secondary-gold);
    font-weight: 600;
  }

  .card {
    border: 1px solid var(--border-color);
    border-radius: 14px;
    box-shadow: 0 2px 10px rgba(0, 61, 122, 0.08);
    overflow: hidden;
  }

  .card-header {
    background: linear-gradient(90deg, var(--primary-navy) 0%, var(--primary-blue) 100%);
    color: white;
    border: none;
    border-bottom: 4px solid var(--secondary-gold);
    padding: 1.5rem;
  }

  .card-header h4 {
    font-weight: 700;
    letter-spacing: 0.3px;
  }

  .card-body {
    padding: 2rem;
  }

  .filters {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .form-control {
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 0.7rem;
    transition: all 0.3s ease;
  }

  .form-control:focus {
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 3px rgba(0, 82, 163, 0.1);
    outline: none;
  }

  .btn-primary {
    background: linear-gradient(90deg, var(--primary-blue), var(--primary-navy)) !important;
    border: none !important;
    font-weight: 700;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 82, 163, 0.2);
  }

  .btn-primary:hover {
    background: linear-gradient(90deg, var(--primary-navy), #00408a) !important;
    box-shadow: 0 6px 16px rgba(0, 61, 122, 0.3);
    transform: translateY(-2px);
  }

  .btn-danger {
    background: linear-gradient(90deg, #ef4444, #dc2626) !important;
    border: none !important;
    color: white !important;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
  }

  .btn-danger:hover {
    background: linear-gradient(90deg, #dc2626, #b91c1c) !important;
    box-shadow: 0 6px 16px rgba(239, 68, 68, 0.3);
    transform: translateY(-2px);
  }

  .table-responsive {
    border-radius: 10px;
    overflow: hidden;
    border: 1px solid var(--border-color);
  }

  .table {
    margin-bottom: 0;
  }

  .table thead th {
    background: linear-gradient(90deg, var(--primary-navy), var(--primary-blue));
    color: white;
    border: none;
    font-weight: 700;
    padding: 1rem;
    letter-spacing: 0.2px;
  }

  .table tbody tr {
    border-bottom: 1px solid var(--border-color);
    transition: all 0.3s ease;
  }

  .table tbody tr:hover {
    background-color: #f5f7fa;
    box-shadow: inset 4px 0 0 var(--secondary-gold);
  }

  .table tbody td {
    padding: 1rem;
    color: var(--text-dark);
    vertical-align: middle;
  }

  .badge {
    font-weight: 700;
    padding: 0.5em 0.95em;
  }

  .badge-teacher {
    background: linear-gradient(90deg, #8b5cf6, #7c3aed);
    color: white;
  }

  .badge-staff {
    background: linear-gradient(90deg, #06b6d4, #0891b2);
    color: white;
  }

  .badge-admin {
    background: linear-gradient(90deg, var(--secondary-gold), #e8be27);
    color: var(--primary-navy);
  }

  .empty-state {
    text-align: center;
    padding: 3rem 2rem;
    color: var(--text-muted);
  }

  .empty-state-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
  }
</style>

<div class="container-fluid">
  <!-- Header -->
  <div class="page-header">
    <h1><i class="fas fa-users me-2" style="color: var(--secondary-gold);"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö</h1>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/superadmin/dashboard" style="color: var(--primary-blue);">Super Admin</a></li>
        <li class="breadcrumb-item active">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</li>
      </ol>
    </nav>
  </div>

  <div class="card">
    <div class="card-header">
      <h4 class="mb-0">üë• ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
    </div>
    <div class="card-body">
      <!-- Filter Form -->
      <form method="GET" action="/superadmin/users" class="filters">
        <select name="role" class="form-control" style="max-width: 200px;">
          <option value="all" <% if (currentRole === 'all') { %>selected<% } %>>-- ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î --</option>
          <option value="teacher" <% if (currentRole === 'teacher') { %>selected<% } %>>‡∏Ñ‡∏£‡∏π</option>
          <option value="staff" <% if (currentRole === 'staff') { %>selected<% } %>>‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option>
          <option value="admin" <% if (currentRole === 'admin') { %>selected<% } %>>‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</option>
          <option value="super_admin" <% if (currentRole === 'super_admin') { %>selected<% } %>>Super Admin</option>
        </select>

        <input type="text" name="search" class="form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" value="<%= searchTerm %>" style="max-width: 300px;">

        <button type="submit" class="btn btn-primary">
          <i class="fas fa-search me-2"></i>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        </button>
      </form>

      <% if (users && users.length > 0) { %>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th width="5%">#</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°</th>
                <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
                <th>‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                <th>‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
                <th>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠</th>
                <th width="15%">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
              </tr>
            </thead>
            <tbody>
              <% users.forEach((user, index) => { %>
                <tr>
                  <td><strong><%= index + 1 %></strong></td>
                  <td><strong><%= user.full_name %></strong></td>
                  <td><small class="text-muted"><%= user.email %></small></td>
                  <td><small><%= user.school_name || '-' %></small></td>
                  <td>
                    <% if (user.role === 'teacher') { %>
                      <span class="badge badge-teacher">üéì ‡∏Ñ‡∏£‡∏π</span>
                    <% } else if (user.role === 'staff') { %>
                      <span class="badge badge-staff">üë®‚Äçüíº ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</span>
                    <% } else if (user.role === 'admin') { %>
                      <span class="badge badge-admin">‚öôÔ∏è ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</span>
                    <% } else if (user.role === 'super_admin') { %>
                      <span class="badge badge-admin">üëë Super Admin</span>
                    <% } %>
                  </td>
                  <td><small class="text-muted"><%= new Date(user.created_at).toLocaleDateString('th-TH') %></small></td>
                  <td>
                    <form action="/superadmin/users/<%= user.id %>/delete" method="POST" style="display: inline;" 
                          onsubmit="return confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ?');">
                      <button type="submit" class="btn btn-sm btn-danger">
                        <i class="fas fa-trash"></i>
                      </button>
                    </form>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>
      <% } else { %>
        <div class="empty-state">
          <div class="empty-state-icon">üë•</div>
          <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç</p>
        </div>
      <% } %>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
