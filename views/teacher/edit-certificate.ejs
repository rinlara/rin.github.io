<% 
  const user = locals.user || {};
  const certificate = locals.certificate || {};
%>

<div class="container my-5">
  <div class="card shadow-lg border-0 rounded-4 p-4">
    <div class="card-body">
      <h2 class="text-center text-primary fw-bold mb-4">
        <i class="bi bi-pencil-square me-2"></i> แก้ไขเกียรติบัตร
      </h2>

      <% if (locals.error) { %>
        <div class="alert alert-danger mb-4 alert-dismissible fade show" role="alert">
          <%= error %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      <% } %>

      <form method="POST" action="/teacher/certificates/edit/<%= certificate.id || '' %>" enctype="multipart/form-data">
        <div class="mb-3">
          <label class="form-label">หมายเลขเกียรติบัตร</label>
          <input type="text" name="certificate_number" class="form-control" 
                 value="<%= certificate.certificate_number || '' %>">
        </div>

        <div class="mb-3">
          <label class="form-label">ชื่อเกียรติบัตร <span class="text-danger">*</span></label>
          <input type="text" name="title" class="form-control" 
                 value="<%= certificate.title || '' %>" required>
        </div>

        <div class="mb-3">
          <label class="form-label">หน่วยงานผู้ออก <span class="text-danger">*</span></label>
          <input type="text" name="issuing_agency" class="form-control" 
                 value="<%= certificate.issuing_agency || '' %>" required>
        </div>

        <div class="mb-3">
          <label class="form-label">คำอธิบายเพิ่มเติม</label>
          <textarea name="description" class="form-control" rows="3"><%= certificate.description || '' %></textarea>
        </div>

        <div class="mb-3">
          <label class="form-label">วันที่ออกเกียรติบัตร</label>
          <input type="date" name="issue_date" class="form-control" 
                 value="<%= certificate.issue_date && certificate.issue_date !== '0000-00-00' ? certificate.issue_date : '' %>">
        </div>

        <div class="mb-4">
          <label class="form-label">อัปโหลดไฟล์ใหม่ (ถ้าต้องการ)</label>
          <input type="file" name="certificate" class="form-control" accept=".pdf,.jpg,.jpeg,.png">
          <div class="form-text mt-2">
            <% if (certificate.file_path) { %>
              ไฟล์ปัจจุบัน: 
              <% if (certificate.file_path.endsWith('.pdf')) { %>
                <i class="bi bi-file-earmark-pdf-fill text-danger me-1"></i>
                <a href="<%= certificate.file_path %>" target="_blank">ดูไฟล์ PDF</a>
              <% } else { %>
                <img src="<%= certificate.file_path %>" alt="เกียรติบัตร"
                     onerror="this.src='/images/default-certificate.png'"
                     style="max-height: 80px; object-fit: cover; border: 1px solid #ddd; border-radius: 4px;">
              <% } %>
            <% } else { %>
              <em>ยังไม่มีไฟล์แนบ</em>
            <% } %>
          </div>
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
          <a href="/teacher/certificates" class="btn btn-secondary me-md-2">
            <i class="bi bi-arrow-left me-1"></i> ยกเลิก
          </a>
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-save me-1"></i> บันทึกการเปลี่ยนแปลง
          </button>
        </div>
      </form>
    </div>
  </div>
</div>