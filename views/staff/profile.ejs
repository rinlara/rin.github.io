<!-- ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç CDN ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ó‡πâ‡∏≤‡∏¢) -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.0/css/all.min.css">

<div class="profile-container">
  <!-- ‚ú® Toast Notification ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏•‡πá‡∏Å + ‡∏™‡∏ß‡∏¢ + ‡∏´‡∏≤‡∏¢‡πÄ‡∏≠‡∏á) -->
  <div id="toastContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 9999;"></div>

  <div class="row g-4">
    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô -->
    <div class="col-lg-4">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-body text-center py-4">
          <div class="profile-img-container mb-3">
            <img src="<%= user?.image_path ? user.image_path + '?t=' + Date.now() : 'https://via.placeholder.com/150/004aad/FFFFFF?text=‡∏£‡∏π‡∏õ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£' %>" 
                 alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£" 
                 class="profile-img rounded-circle"
                 id="profileImage">
          </div>
          
          <h5 class="card-title text-primary fw-bold mt-2"><%= user?.full_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠' %></h5>
          <p class="text-muted mb-3"><%= user?.position || '-' %></p>
          
          <button class="btn btn-outline-primary w-100 mb-3" data-bs-toggle="modal" data-bs-target="#uploadImageModal">
            <i class="fas fa-camera me-1"></i> ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
          </button>
        </div>
      </div>
    </div>

    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• -->
    <div class="col-lg-8">
      <div class="card shadow-sm border-0 h-100">
        <div class="card-header bg-white border-0 py-3">
          <h3 class="card-title text-primary mb-0">
            <i class="fas fa-user-edit me-2"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£)
          </h3>
        </div>
        <div class="card-body">
          <form action="/staff/profile/update" method="POST">
            <div class="row g-3">
              <div class="col-md-12">
                <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="full_name" value="<%= user?.full_name || '' %>" required>
              </div>
              
              <div class="col-md-6">
                <label class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏• <span class="text-danger">*</span></label>
                <input type="email" class="form-control" name="email" value="<%= user?.email || '' %>" required>
              </div>
              
              <div class="col-md-6">
                <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå <span class="text-danger">*</span></label>
                <input type="tel" class="form-control" name="phone" value="<%= user?.phone || '' %>" required>
              </div>
              
              <div class="col-md-6">
                <label class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á <span class="text-danger">*</span></label>
                <select class="form-select" name="position" required>
                  <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</option>
                  <optgroup label="‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£">
                    <option value="‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£)" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£)') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£)</option>
                    <option value="‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£" <%= (user?.position === '‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£') ? 'selected' : '' %>>‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£</option>
                    <option value="‡∏ô‡∏±‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                  </optgroup>
                  <optgroup label="‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå">
                    <option value="‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</option>
                    <option value="‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ" <%= (user?.position === '‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ') ? 'selected' : '' %>>‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</option>
                    <option value="‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏™‡∏î‡∏∏" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏™‡∏î‡∏∏') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏™‡∏î‡∏∏</option>
                    <option value="‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏û‡∏±‡∏™‡∏î‡∏∏" <%= (user?.position === '‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏û‡∏±‡∏™‡∏î‡∏∏') ? 'selected' : '' %>>‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏û‡∏±‡∏™‡∏î‡∏∏</option>
                  </optgroup>
                  <optgroup label="‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô">
                    <option value="‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô</option>
                    <option value="‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</option>
                  </optgroup>
                  <optgroup label="‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•">
                    <option value="‡∏ô‡∏±‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</option>
                  </optgroup>
                  <optgroup label="‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ñ‡∏£‡∏π‡πÅ‡∏•‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                    <option value="‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ñ‡∏£‡∏π)" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ñ‡∏£‡∏π)') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Ñ‡∏£‡∏π)</option>
                    <option value="‡∏ô‡∏±‡∏Å‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option>
                  </optgroup>
                  <optgroup label="‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
                    <option value="‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°)" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°)') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°)</option>
                    <option value="‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                  </optgroup>
                  <optgroup label="‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏≤‡∏á‡πÑ‡∏Å‡∏• / ICT">
                    <option value="‡∏ô‡∏±‡∏Å‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®</option>
                    <option value="‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</option>
                    <option value="‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢" <%= (user?.position === '‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢') ? 'selected' : '' %>>‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢</option>
                  </optgroup>
                  <optgroup label="‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Ñ‡∏î‡∏µ">
                    <option value="‡∏ô‡∏¥‡∏ï‡∏¥‡∏Å‡∏£" <%= (user?.position === '‡∏ô‡∏¥‡∏ï‡∏¥‡∏Å‡∏£') ? 'selected' : '' %>>‡∏ô‡∏¥‡∏ï‡∏¥‡∏Å‡∏£</option>
                    <option value="‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢" <%= (user?.position === '‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢') ? 'selected' : '' %>>‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢</option>
                  </optgroup>
                  <optgroup label="‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ô‡∏¥‡πÄ‡∏ó‡∏® ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•">
                    <option value="‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏¥‡πÄ‡∏ó‡∏®‡∏Å‡πå" <%= (user?.position === '‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏¥‡πÄ‡∏ó‡∏®‡∏Å‡πå') ? 'selected' : '' %>>‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ô‡∏¥‡πÄ‡∏ó‡∏®‡∏Å‡πå</option>
                    <option value="‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏ô‡∏¥‡πÄ‡∏ó‡∏®)" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏ô‡∏¥‡πÄ‡∏ó‡∏®)') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ (‡∏ô‡∏¥‡πÄ‡∏ó‡∏®)</option>
                  </optgroup>
                  <optgroup label="‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô">
                    <option value="‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô" <%= (user?.position === '‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô') ? 'selected' : '' %>>‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</option>
                    <option value="‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö" <%= (user?.position === '‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö') ? 'selected' : '' %>>‡∏ô‡∏±‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</option>
                  </optgroup>
                  <optgroup label="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">
                    <option value="‡∏•‡∏π‡∏Å‡∏à‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥" <%= (user?.position === '‡∏•‡∏π‡∏Å‡∏à‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥') ? 'selected' : '' %>>‡∏•‡∏π‡∏Å‡∏à‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥</option>
                    <option value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£" <%= (user?.position === '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£') ? 'selected' : '' %>>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</option>
                    <option value="‡∏•‡∏π‡∏Å‡∏à‡πâ‡∏≤‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß" <%= (user?.position === '‡∏•‡∏π‡∏Å‡∏à‡πâ‡∏≤‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß') ? 'selected' : '' %>>‡∏•‡∏π‡∏Å‡∏à‡πâ‡∏≤‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß</option>
                    <option value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ" <%= (user?.position === '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ') ? 'selected' : '' %>>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡∏ö‡∏£‡∏ñ</option>
                    <option value="‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£" <%= (user?.position === '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£') ? 'selected' : '' %>>‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£</option>
                  </optgroup>
                </select>
              </div>
              
              <div class="col-md-6">
                <label class="form-label">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô <span class="text-danger">*</span></label>
                <input type="text" class="form-control" name="school_name" 
                       value="<%= user?.school_name || '‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô ‡πÄ‡∏Ç‡∏ï 2' %>" 
                       required readonly>
              </div>
            </div>
            
            <div class="mt-4">
              <button type="submit" class="btn btn-primary px-4 py-2">
                <i class="fas fa-save me-1"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û -->
<div class="modal fade" id="uploadImageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content border-0 shadow">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title"><i class="fas fa-cloud-upload-alt me-2"></i>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="imageUploadForm">
          <div class="mb-3">
            <label for="imageFile" class="form-label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (JPG, PNG)</label>
            <input class="form-control" type="file" id="imageFile" name="profile_image" accept="image/jpeg,image/png" required>
            <div class="form-text text-muted">‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 MB</div>
          </div>
          <button type="submit" class="btn btn-primary w-100" id="uploadBtn">
            <i class="fas fa-upload me-1"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
          </button>
        </form>
        <div id="uploadMessage" class="mt-2" style="display: none;"></div>
      </div>
    </div>
  </div>
</div>

<style>
/* üé® ‡πÇ‡∏ó‡∏ô‡∏™‡∏µ: ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏£‡∏° + ‡πÄ‡∏ó‡∏≤‡∏™‡∏ß‡πà‡∏≤‡∏á */
.profile-container {
  background: white;
  padding: 2rem;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  margin-bottom: 2rem;
}

.profile-img-container {
  width: 150px;
  height: 150px;
  margin: 0 auto;
  overflow: hidden;
  border: 4px solid #e2e8f0;
  border-radius: 50%;
}

.profile-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.form-label {
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #1e293b;
}

.form-control, .form-select {
  padding: 0.75rem;
  border: 1px solid #cbd5e1;
  border-radius: 10px;
  font-size: 1rem;
  transition: border-color 0.2s;
}

.form-control:focus, .form-select:focus {
  border-color: #004aad;
  box-shadow: 0 0 0 3px rgba(0, 74, 173, 0.15);
}

.btn-primary {
  background: #004aad;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 10px;
  font-weight: 600;
  transition: background 0.2s;
}

.btn-primary:hover {
  background: #003a8a;
}

.card {
  border: none;
  border-radius: 16px;
  box-shadow: 0 3px 12px rgba(0,0,0,0.06);
  transition: box-shadow 0.3s;
}

.card:hover {
  box-shadow: 0 6px 18px rgba(0,0,0,0.09);
}

.card-header {
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e2e8f0;
}

/* ‚ú® Toast Notification ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà */
.toast-custom {
  min-width: 280px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  border: none;
  background: white;
  color: #1e293b;
  opacity: 0;
  animation: fadeInOut 3s forwards;
}

.toast-custom .toast-body {
  padding: 1rem 1.2rem;
  display: flex;
  align-items: center;
  gap: 0.8rem;
}

.toast-success .toast-body {
  border-left: 4px solid #10b981;
}

.toast-error .toast-body {
  border-left: 4px solid #ef4444;
}

.toast-body i {
  font-size: 1.2rem;
}

@keyframes fadeInOut {
  0% { opacity: 0; transform: translateY(-20px); }
  15% { opacity: 1; transform: translateY(0); }
  85% { opacity: 1; transform: translateY(0); }
  100% { opacity: 0; transform: translateY(-20px); }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // ‚ú® ‡πÅ‡∏™‡∏î‡∏á toast ‡∏à‡∏≤‡∏Å query string (success/error)
  const urlParams = new URLSearchParams(window.location.search);
  const success = urlParams.get('success');
  const error = urlParams.get('error');

  if (success) {
    showToast(success, 'success');
    // ‡∏•‡∏ö query string ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å URL
    history.replaceState(null, '', window.location.pathname);
  }
  if (error) {
    showToast(error, 'error');
    history.replaceState(null, '', window.location.pathname);
  }

  // ‚ú® ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á toast
  function showToast(message, type) {
    const toastContainer = document.getElementById('toastContainer');
    const icon = type === 'success' ? 'fas fa-check-circle text-success' : 'fas fa-exclamation-circle text-danger';
    const toastClass = type === 'success' ? 'toast-success' : 'toast-error';
    
    const toastHTML = `
      <div class="toast-custom ${toastClass}" role="alert">
        <div class="toast-body">
          <i class="${icon}"></i>
          <span>${message}</span>
        </div>
      </div>
    `;
    
    toastContainer.innerHTML = toastHTML;
    setTimeout(() => {
      toastContainer.innerHTML = '';
    }, 3000);
  }

  // ‚ú® ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
  const uploadForm = document.getElementById('imageUploadForm');
  if (uploadForm) {
    uploadForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const fileInput = document.getElementById('imageFile');
      const file = fileInput.files[0];
      const uploadBtn = document.getElementById('uploadBtn');

      if (!file) {
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û', 'error');
        return;
      }

      const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png'];
      if (!allowedTypes.includes(file.type)) {
        showToast('‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå .jpeg, .jpg, .png ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô', 'error');
        return;
      }

      if (file.size > 2 * 1024 * 1024) {
        showToast('‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2 MB', 'error');
        return;
      }

      const formData = new FormData();
      formData.append('profile_image', file);

      uploadBtn.disabled = true;
      uploadBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...';

      try {
        const response = await fetch('/staff/profile/upload-image', {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (response.ok && result.success) {
          document.getElementById('profileImage').src = result.imagePath + '?t=' + new Date().getTime();
          showToast('‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
          setTimeout(() => {
            const modal = bootstrap.Modal.getInstance(document.getElementById('uploadImageModal'));
            modal.hide();
          }, 1200);
        } else {
          showToast(result.error || '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
      } finally {
        uploadBtn.disabled = false;
        uploadBtn.innerHTML = '<i class="fas fa-upload me-1"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û';
      }
    });
  }
});
</script>