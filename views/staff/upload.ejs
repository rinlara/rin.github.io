
<% /* ‡πÉ‡∏ä‡πâ jsDelivr ‡πÅ‡∏ó‡∏ô cdnjs ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ù‡πà‡∏≤ CSP */ %>

<div class="upload-container shadow-lg">
  <div class="page-header text-center mb-4">
    <h1 class="page-title"><i class="fas fa-award text-primary me-2"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£</h1>
    <p class="page-subtitle text-muted">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£ | ‡∏™‡∏û‡∏õ.‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô ‡πÄ‡∏Ç‡∏ï 2</p>
  </div>

  <!-- ‚úÖ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô -->
  <% if (locals.success) { %>
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <i class="fas fa-check-circle me-2"></i> <%= success %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% } %>

  <% if (locals.error) { %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="fas fa-exclamation-triangle me-2"></i> <%= error %>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% } %>

  <!-- ‚úÖ ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç -->
  <div class="alert alert-warning fade-in mb-4">
    <i class="fas fa-info-circle me-2"></i> 
    <strong>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</strong><br>
    <small class="text-muted">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á ‡∏´‡∏≤‡∏Å‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå ‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏à‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏£‡∏≤‡∏ö‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤</small>
  </div>

  <!-- ‚úÖ ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î -->
  <form method="POST" action="/staff/upload" enctype="multipart/form-data" id="uploadForm">
    
    <!-- üîπ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£ -->
<div class="form-group mb-4">
  <label for="certificate_number" class="form-label d-flex align-items-center">
    <i class="fas fa-hashtag text-primary me-2"></i> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£ <span class="text-danger">*</span>
  </label>
  <input 
    type="text" 
    id="certificate_number" 
    name="certificate_number" 
    class="form-control form-control-lg"
    required 
    placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 10437/2568 ‡∏´‡∏£‡∏∑‡∏≠ ‡πë‡πê‡πî‡πì‡πó/‡πí‡πï‡πñ‡πò"
    maxlength="30"
    autocomplete="off"
    pattern="[0-9‡πê-‡πô\/\-]+"
    title="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡πÑ‡∏ó‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏≤‡∏´‡∏£‡∏±‡∏ö), / ‡∏´‡∏£‡∏∑‡∏≠ - ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"
  >
  <div class="form-text text-muted mt-2">
    <strong>‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:</strong> <code>10437/2568</code>, <code>‡πë‡πê‡πî‡πì‡πó/‡πí‡πï‡πñ‡πò</code><br>
    - ‡πÉ‡∏™‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á <strong>‡πÄ‡∏•‡∏Ç‡∏≠‡∏≤‡∏´‡∏£‡∏±‡∏ö (0-9)</strong> ‡πÅ‡∏•‡∏∞ <strong>‡πÄ‡∏•‡∏Ç‡πÑ‡∏ó‡∏¢ (‡πê-‡πô)</strong><br>
    - ‡πÉ‡∏ä‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ <code>/</code> ‡∏´‡∏£‡∏∑‡∏≠ <code>-</code> ‡∏Ñ‡∏±‡πà‡∏ô‡πÑ‡∏î‡πâ
  </div>
</div>
    <!-- üîπ ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£ -->
    <div class="form-group mb-4">
      <label for="title" class="form-label d-flex align-items-center">
        <i class="fas fa-file-alt text-primary me-2"></i> ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£ <span class="text-danger">*</span>
      </label>
      <input 
        type="text" 
        id="title" 
        name="title" 
        class="form-control form-control-lg" 
        required 
        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏Ñ‡∏£‡∏π‡∏î‡∏µ‡πÄ‡∏î‡πà‡∏ô ‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 2568"
        maxlength="150"
      >
    </div>

    <!-- üîπ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏≠‡∏Å -->
    <div class="form-group mb-4">
      <label for="issuing_agency" class="form-label d-flex align-items-center">
        <i class="fas fa-building text-primary me-2"></i> ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏≠‡∏Å‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£ <span class="text-danger">*</span>
      </label>
      <input 
        type="text" 
        id="issuing_agency" 
        name="issuing_agency" 
        class="form-control form-control-lg" 
        required 
        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô ‡πÄ‡∏Ç‡∏ï 2"
        maxlength="200"
      >
    </div>

    <!-- üîπ ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ -->
    <div class="form-group mb-4">
      <label for="description" class="form-label d-flex align-items-center">
        <i class="fas fa-sticky-note text-primary me-2"></i> ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
      </label>
      <textarea 
        id="description" 
        name="description" 
        class="form-control" 
        rows="3" 
        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏Ñ‡∏£‡∏π‡∏î‡∏µ‡πÄ‡∏î‡πà‡∏ô ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏Ç‡∏ï‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà"
        maxlength="500"
      ></textarea>
    </div>

    <!-- üîπ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå (simple input, removed dashed box) -->
    <div class="form-group mb-4">
      <label for="file" class="form-label d-flex align-items-center">
        <i class="fas fa-cloud-upload-alt text-primary me-2"></i> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£
      </label>
      <input
        type="file"
        id="file"
        name="certificate"
        required
        accept=".pdf,.jpg,.jpeg,.png"
        class="form-control"
      />
      <div class="form-text text-muted mt-2">
        ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: <strong>.pdf, .jpg, .jpeg, .png</strong> | ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î <strong>10 MB</strong>
      </div>
      <div id="fileName" class="mt-2 fw-semibold text-dark"></div>
        <div id="ocrStatus" class="mt-3" style="display:none;"></div>
    </div>

    <!-- üîπ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å -->
    <div class="form-group mb-4">
      <label for="issue_date" class="form-label d-flex align-items-center">
        <i class="fas fa-calendar-day text-primary me-2"></i> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£
      </label>
      <input 
        type="date" 
        id="issue_date" 
        name="issue_date" 
        class="form-control form-control-lg"
      >
      <div class="form-text text-muted mt-1">
        ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡πÉ‡∏ô‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏£‡∏¥‡∏á
      </div>
    </div>

    <!-- üîπ ‡∏õ‡∏∏‡πà‡∏°‡∏™‡πà‡∏á -->
    <div class="text-center mt-4">
      <button type="submit" class="btn btn-primary btn-lg px-5 py-2 rounded-pill shadow-sm">
        <i class="fas fa-cloud-upload-alt me-2"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£
      </button>
    </div>
  </form>

  <footer class="footer mt-5 pt-3 border-top text-center text-muted">
    ¬© <%= new Date().getFullYear() %> ‡∏™‡∏û‡∏õ.‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô ‡πÄ‡∏Ç‡∏ï 2
  </footer>
</div>

<style>
.upload-container {
  max-width: 680px;
  margin: 40px auto;
  background: #ffffff;
  padding: 40px;
  border-radius: 20px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.page-title {
  font-size: 1.8rem;
  font-weight: 700;
  color: #0d6efd;
}

.page-subtitle {
  font-size: 1.05rem;
  margin-top: 5px;
  color: #6c757d;
}

.form-label {
  font-weight: 600;
  margin-bottom: 0.6rem;
}

.form-control, .form-select {
  padding: 0.75rem 1rem;
  border: 1px solid #dee2e6;
  border-radius: 12px;
  font-size: 1.05rem;
}

.form-control:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.25rem rgba(13,110,253,0.15);
}

.upload-area {
  background: #f8f9ff;
  border: 2px dashed #0d6efd;
  border-radius: 16px;
  transition: all 0.3s ease;
  position: relative;
}

.upload-area:hover {
  background: #eef5ff;
}

.alert {
  border-radius: 12px;
}

.alert i {
  font-size: 1.1rem;
}

.fade-in {
  animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.footer {
  font-size: 0.9rem;
  color: #6c757d;
}

@media (max-width: 576px) {
  .upload-container {
    padding: 25px;
    margin: 20px auto;
  }
  .page-title {
    font-size: 1.5rem;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const fileInput = document.getElementById('file');
  const fileName = document.getElementById('fileName');
  const triggerFile = document.getElementById('triggerFile');
  const uploadForm = document.getElementById('uploadForm');

  triggerFile.addEventListener('click', () => {
    fileInput.click();
  });

  fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) {
      fileName.textContent = "üìÅ " + fileInput.files[0].name;
    } else {
      fileName.textContent = "";
    }
  });

  uploadForm.addEventListener('submit', function(e) {
    const file = fileInput.files[0];
    const certNum = document.getElementById('certificate_number').value.trim();
    const issueDateInput = document.getElementById('issue_date').value;

    if (!file) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£");
      e.preventDefault();
      return;
    }

    const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'image/jpg'];
    if (!allowedTypes.includes(file.type)) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå .pdf, .jpg, .jpeg ‡∏´‡∏£‡∏∑‡∏≠ .png ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô!");
      e.preventDefault();
      return;
    }

    if (file.size > 10 * 1024 * 1024) {
      alert("‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 MB");
      e.preventDefault();
      return;
    }

    if (!certNum) {
      alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£");
      e.preventDefault();
      return;
    }

    const pattern = /^[0-9‡πê-‡πô]+[\/\-][0-9‡πê-‡πô]+$/;
    if (!pattern.test(certNum)) {
      alert("‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!\n‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á:\n- 10437/2568\n- ‡πë‡πê‡πî‡πì‡πó/‡πí‡πï‡πñ‡πò");
      e.preventDefault();
      return;
    }

    if (issueDateInput) {
      const issueDate = new Date(issueDateInput);
      const today = new Date();
      const minDate = new Date();
      minDate.setFullYear(today.getFullYear() - 5);

      if (issueDate > today) {
        alert("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÑ‡∏î‡πâ");
        e.preventDefault();
        return;
      }
      if (issueDate < minDate) {
        alert("‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏õ‡∏µ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á");
        e.preventDefault();
        return;
      }
    }
  });
});
</script>